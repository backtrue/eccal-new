<!DOCTYPE html>
<html>
<head>
    <title>ming2635163@gmail.com èªè­‰æ¸¬è©¦</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .status { background: #e3f2fd; padding: 15px; border-radius: 4px; margin: 10px 0; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { background: #1976d2; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .warning-box { background: #fff8e1; border: 2px solid #ff9800; padding: 15px; border-radius: 4px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ming2635163@gmail.com èªè­‰å•é¡Œæª¢æ¸¬</h1>
        
        <div class="warning-box">
            <h3>ğŸ” é é˜²æ€§æª¢æŸ¥</h3>
            <p>æ­£åœ¨æª¢æŸ¥æ˜¯å¦æœƒé‡åˆ°èˆ‡ pin10andy@gmail.com ç›¸åŒçš„èªè­‰å•é¡Œ</p>
            <p>âœ… å·²å°‡ ming2635163@gmail.com åŠ å…¥ç‰¹æ®Šç›£æ§æ¸…å–®</p>
            <p>âœ… é å…ˆä¿®å¾© token æœ‰æ•ˆæœŸ</p>
        </div>
        
        <div id="status" class="status">æª¢æŸ¥ä¸­...</div>
        
        <h2>èªè­‰æ¸¬è©¦</h2>
        <button onclick="checkTokenStatus()">ğŸ” æª¢æŸ¥ Token ç‹€æ…‹</button>
        <button onclick="testDirectAuth()">ğŸš€ æ¸¬è©¦ç›´æ¥èªè­‰</button>
        <button onclick="forceTokenFix()">ğŸ”§ å¼·åˆ¶ä¿®å¾© Token</button>
        <button onclick="testOAuthFlow()">ğŸ”— æ¸¬è©¦ OAuth æµç¨‹</button>
        
        <h2>ç™»å…¥é€£çµ</h2>
        <p><a href="/api/auth/google?returnTo=%2Fdashboard" target="_blank">ğŸ”— Google OAuth ç™»å…¥</a></p>
        <p><a href="/dashboard" target="_blank">ğŸ“Š å‰å¾€å„€è¡¨æ¿</a></p>
        
        <div id="results"></div>
        <div id="serverLogs" style="background: #000; color: #0f0; padding: 10px; font-family: monospace; height: 200px; overflow-y: auto; margin-top: 20px;"></div>
    </div>

    <script>
        async function checkTokenStatus() {
            document.getElementById('results').innerHTML = '<p>ğŸ”„ æª¢æŸ¥ ming2635163@gmail.com çš„ token ç‹€æ…‹...</p>';
            
            try {
                const response = await fetch('/api/admin/fix-user-token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: 'ming2635163@gmail.com' })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('results').innerHTML = `
                        <div class="status success">
                            <h3>âœ… Token ç‹€æ…‹æ­£å¸¸</h3>
                            <p>ç”¨æˆ¶: ${data.user.email}</p>
                            <p>æœƒå“¡ç­‰ç´š: ${data.user.membershipLevel}</p>
                            <p>ç©åˆ†: ${data.user.credits}</p>
                            <p>æ–°åˆ°æœŸæ™‚é–“: ${data.newExpiry}</p>
                        </div>
                    `;
                } else {
                    document.getElementById('results').innerHTML = `
                        <div class="status error">
                            <h3>âŒ Token å•é¡Œ</h3>
                            <p>éŒ¯èª¤: ${data.error}</p>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('results').innerHTML = `
                    <div class="status error">
                        <h3>âŒ æª¢æŸ¥å¤±æ•—</h3>
                        <p>éŒ¯èª¤: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function testDirectAuth() {
            try {
                const response = await fetch('/api/user/me');
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('status').innerHTML = `
                        <h3>âœ… ç›´æ¥èªè­‰æˆåŠŸï¼</h3>
                        <p>ç”¨æˆ¶: ${data.email}</p>
                        <p>ç©åˆ†: ${data.credits}</p>
                    `;
                    document.getElementById('status').className = 'status success';
                } else {
                    document.getElementById('status').innerHTML = `
                        <h3>âŒ èªè­‰å¤±æ•—</h3>
                        <p>éŒ¯èª¤: ${data.error}</p>
                    `;
                    document.getElementById('status').className = 'status error';
                }
            } catch (error) {
                document.getElementById('status').innerHTML = `
                    <h3>âŒ é€£ç·šéŒ¯èª¤</h3>
                    <p>${error.message}</p>
                `;
                document.getElementById('status').className = 'status error';
            }
        }
        
        async function forceTokenFix() {
            document.getElementById('results').innerHTML = '<p>ğŸ”§ å¼·åˆ¶ä¿®å¾© ming2635163@gmail.com çš„ token...</p>';
            
            try {
                const response = await fetch('/api/admin/fix-user-token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: 'ming2635163@gmail.com' })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('results').innerHTML = `
                        <div class="status success">
                            <h3>âœ… Token ä¿®å¾©æˆåŠŸ</h3>
                            <p>${data.message}</p>
                            <p>æ–°åˆ°æœŸæ™‚é–“: ${data.newExpiry}</p>
                        </div>
                    `;
                } else {
                    document.getElementById('results').innerHTML = `
                        <div class="status error">
                            <h3>âŒ ä¿®å¾©å¤±æ•—</h3>
                            <p>éŒ¯èª¤: ${data.error}</p>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('results').innerHTML = `
                    <div class="status error">
                        <h3>âŒ ä¿®å¾©å¤±æ•—</h3>
                        <p>éŒ¯èª¤: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function testOAuthFlow() {
            document.getElementById('results').innerHTML = '<p>ğŸ”„ æ¸¬è©¦ OAuth æµç¨‹...</p>';
            
            try {
                // æ¨¡æ“¬ä¸€å€‹è¼•é‡ç´šçš„ OAuth æ¸¬è©¦
                const response = await fetch('/api/auth/google', {
                    method: 'GET',
                    redirect: 'manual'
                });
                
                if (response.status === 302 || response.status === 0) {
                    document.getElementById('results').innerHTML = `
                        <div class="status success">
                            <h3>âœ… OAuth ç«¯é»æ­£å¸¸</h3>
                            <p>Google OAuth é‡å®šå‘æ­£å¸¸å·¥ä½œ</p>
                        </div>
                    `;
                } else {
                    document.getElementById('results').innerHTML = `
                        <div class="status error">
                            <h3>âŒ OAuth ç«¯é»ç•°å¸¸</h3>
                            <p>ç‹€æ…‹: ${response.status}</p>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('results').innerHTML = `
                    <div class="status error">
                        <h3>âŒ OAuth æ¸¬è©¦å¤±æ•—</h3>
                        <p>éŒ¯èª¤: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // è‡ªå‹•é–‹å§‹æª¢æŸ¥
        checkTokenStatus();
    </script>
</body>
</html>