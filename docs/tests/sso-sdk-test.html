<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ECCAL SSO SDK æ¸¬è©¦é é¢</title>
  
  <!-- å¼•å…¥ ECCAL Auth SDK -->
  <script src="https://eccal.thinkwithblack.com/eccal-auth-sdk.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      max-width: 600px;
      width: 100%;
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }
    
    .header p {
      opacity: 0.9;
      font-size: 14px;
    }
    
    .content {
      padding: 30px;
    }
    
    .section {
      margin-bottom: 25px;
    }
    
    .section h2 {
      font-size: 18px;
      color: #333;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }
    
    button {
      width: 100%;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      background: #4285f4;
      color: white;
      border: none;
      border-radius: 8px;
      transition: all 0.3s ease;
      margin-bottom: 10px;
    }
    
    button:hover {
      background: #357ae8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button.secondary {
      background: #f5f5f5;
      color: #333;
    }
    
    button.secondary:hover {
      background: #e0e0e0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    button.danger {
      background: #dc3545;
    }
    
    button.danger:hover {
      background: #c82333;
      box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
    }
    
    .user-info {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .user-info p {
      margin: 8px 0;
      color: #555;
      font-size: 14px;
    }
    
    .user-info strong {
      color: #333;
      min-width: 100px;
      display: inline-block;
    }
    
    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .badge.pro {
      background: #ffd700;
      color: #333;
    }
    
    .badge.free {
      background: #e0e0e0;
      color: #666;
    }
    
    .hidden {
      display: none;
    }
    
    .log-section {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 8px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.6;
    }
    
    .log-entry {
      margin: 4px 0;
      padding: 4px 0;
      border-bottom: 1px solid #333;
    }
    
    .log-entry:last-child {
      border-bottom: none;
    }
    
    .log-time {
      color: #858585;
      margin-right: 8px;
    }
    
    .log-success {
      color: #4ec9b0;
    }
    
    .log-error {
      color: #f48771;
    }
    
    .log-info {
      color: #569cd6;
    }
    
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-online {
      background: #28a745;
    }
    
    .status-offline {
      background: #dc3545;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ” ECCAL SSO SDK æ¸¬è©¦</h1>
      <p>é€™å€‹é é¢ç¤ºç¯„å¦‚ä½•ä½¿ç”¨ ECCAL Auth SDK é€²è¡Œ SSO æ•´åˆ</p>
    </div>
    
    <div class="content">
      <!-- æœªç™»å…¥æ™‚é¡¯ç¤º -->
      <div id="login-section">
        <div class="section">
          <h2>ğŸ‘¤ ç”¨æˆ¶ç™»å…¥</h2>
          <p style="color: #666; margin-bottom: 15px;">
            é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œä½¿ç”¨ Google å¸³è™Ÿç™»å…¥
          </p>
          <button onclick="handleLogin()">
            ğŸ” ä½¿ç”¨ Google ç™»å…¥
          </button>
        </div>
        
        <div class="section">
          <h2>ğŸ“‹ æ¸¬è©¦è³‡è¨Š</h2>
          <div class="user-info">
            <p><strong>ç‹€æ…‹ï¼š</strong><span class="status-indicator status-offline"></span>æœªç™»å…¥</p>
            <p><strong>SDK ç‰ˆæœ¬ï¼š</strong>1.0.0</p>
            <p><strong>API ç«¯é»ï¼š</strong>eccal.thinkwithblack.com</p>
          </div>
        </div>
      </div>
      
      <!-- ç™»å…¥å¾Œé¡¯ç¤º -->
      <div id="user-section" class="hidden">
        <div class="section">
          <h2>âœ… ç™»å…¥æˆåŠŸï¼</h2>
          <div class="user-info">
            <p><strong>ç‹€æ…‹ï¼š</strong><span class="status-indicator status-online"></span>å·²ç™»å…¥</p>
            <p><strong>å§“åï¼š</strong><span id="user-name"></span></p>
            <p><strong>Emailï¼š</strong><span id="user-email"></span></p>
            <p><strong>ç”¨æˆ¶ IDï¼š</strong><span id="user-id"></span></p>
            <p>
              <strong>æœƒå“¡ç­‰ç´šï¼š</strong>
              <span id="user-membership-badge"></span>
            </p>
            <p><strong>é»æ•¸é¤˜é¡ï¼š</strong><span id="user-credits"></span></p>
          </div>
        </div>
        
        <div class="section">
          <h2>ğŸ”§ æ¸¬è©¦åŠŸèƒ½</h2>
          <button class="secondary" onclick="testGetUser()">
            ğŸ“‹ å–å¾—ç”¨æˆ¶è³‡è¨Š
          </button>
          <button class="secondary" onclick="testCheckAuth()">
            ğŸ” æª¢æŸ¥èªè­‰ç‹€æ…‹
          </button>
          <button class="secondary" onclick="testGetToken()">
            ğŸ« æŸ¥çœ‹ Token
          </button>
          <button class="danger" onclick="handleLogout()">
            ğŸšª ç™»å‡º
          </button>
        </div>
      </div>
      
      <!-- äº‹ä»¶æ—¥èªŒ -->
      <div class="section">
        <h2>ğŸ“Š äº‹ä»¶æ—¥èªŒ</h2>
        <div class="log-section" id="log-container">
          <div class="log-entry">
            <span class="log-time">[è¼‰å…¥ä¸­...]</span>
            <span class="log-info">ç­‰å¾… SDK åˆå§‹åŒ–...</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // æ—¥èªŒç³»çµ±
    const logContainer = document.getElementById('log-container');
    
    function log(message, type = 'info') {
      const time = new Date().toLocaleTimeString('zh-TW');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `
        <span class="log-time">[${time}]</span>
        <span class="log-${type}">${message}</span>
      `;
      logContainer.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;
      
      // åŒæ™‚è¼¸å‡ºåˆ° console
      console.log(`[${time}] ${message}`);
    }
    
    // åˆå§‹åŒ– SDK
    log('ğŸš€ é–‹å§‹åˆå§‹åŒ– ECCAL Auth SDK...', 'info');
    
    const eccalAuth = new EccalAuth({
      siteName: 'test',  // æ¸¬è©¦æœå‹™åç¨±
      
      onLogin: (user) => {
        log(`âœ… ç”¨æˆ¶ç™»å…¥æˆåŠŸ: ${user.email}`, 'success');
        updateUI(user);
      },
      
      onLogout: () => {
        log('ğŸ‘‹ ç”¨æˆ¶å·²ç™»å‡º', 'info');
        showLoginSection();
      },
      
      onError: (error) => {
        log(`âŒ ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
        alert('ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
      }
    });
    
    log('âœ… SDK åˆå§‹åŒ–å®Œæˆ', 'success');
    
    // ç™»å…¥è™•ç†
    function handleLogin() {
      log('ğŸ” é–‹å§‹ Google SSO ç™»å…¥æµç¨‹...', 'info');
      eccalAuth.login();
    }
    
    // ç™»å‡ºè™•ç†
    function handleLogout() {
      if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
        log('ğŸšª åŸ·è¡Œç™»å‡º...', 'info');
        eccalAuth.logout();
      }
    }
    
    // æ›´æ–° UI
    function updateUI(user) {
      document.getElementById('login-section').classList.add('hidden');
      document.getElementById('user-section').classList.remove('hidden');
      
      document.getElementById('user-name').textContent = user.name || 'æœªæä¾›';
      document.getElementById('user-email').textContent = user.email;
      document.getElementById('user-id').textContent = user.id;
      document.getElementById('user-credits').textContent = user.credits || 0;
      
      // æœƒå“¡ç­‰ç´šå¾½ç« 
      const membership = user.membership || 'free';
      const badgeClass = membership === 'pro' ? 'pro' : 'free';
      const badgeText = membership === 'pro' ? 'PRO' : 'FREE';
      document.getElementById('user-membership-badge').innerHTML = 
        `<span class="badge ${badgeClass}">${badgeText}</span>`;
      
      log(`ğŸ“Š UI æ›´æ–°å®Œæˆ`, 'success');
    }
    
    // é¡¯ç¤ºç™»å…¥å€æ®µ
    function showLoginSection() {
      document.getElementById('login-section').classList.remove('hidden');
      document.getElementById('user-section').classList.add('hidden');
    }
    
    // æ¸¬è©¦åŠŸèƒ½ï¼šå–å¾—ç”¨æˆ¶è³‡è¨Š
    function testGetUser() {
      log('ğŸ” åŸ·è¡Œ: getUser()', 'info');
      const user = eccalAuth.getUser();
      log(`ğŸ“‹ ç”¨æˆ¶è³‡è¨Š: ${JSON.stringify(user)}`, 'success');
      alert('ç”¨æˆ¶è³‡è¨Šï¼ˆè«‹æŸ¥çœ‹ Consoleï¼‰:\n' + JSON.stringify(user, null, 2));
    }
    
    // æ¸¬è©¦åŠŸèƒ½ï¼šæª¢æŸ¥èªè­‰ç‹€æ…‹
    async function testCheckAuth() {
      log('ğŸ” åŸ·è¡Œ: checkAuth()', 'info');
      const user = await eccalAuth.checkAuth();
      if (user) {
        log(`âœ… èªè­‰æœ‰æ•ˆï¼Œç”¨æˆ¶: ${user.email}`, 'success');
        alert('èªè­‰æœ‰æ•ˆï¼\n' + JSON.stringify(user, null, 2));
      } else {
        log('âš ï¸ èªè­‰ç„¡æ•ˆæˆ–å·²éæœŸ', 'error');
        alert('èªè­‰ç„¡æ•ˆæˆ–å·²éæœŸ');
      }
    }
    
    // æ¸¬è©¦åŠŸèƒ½ï¼šå–å¾— Token
    function testGetToken() {
      log('ğŸ” åŸ·è¡Œ: getToken()', 'info');
      const token = eccalAuth.getToken();
      if (token) {
        log(`ğŸ« Token (å‰50å­—å…ƒ): ${token.substring(0, 50)}...`, 'success');
        alert('Tokenï¼ˆè«‹æŸ¥çœ‹ Consoleï¼‰:\n' + token);
        console.log('å®Œæ•´ Token:', token);
      } else {
        log('âš ï¸ æ²’æœ‰ Token', 'error');
        alert('æ²’æœ‰ Token');
      }
    }
    
    // é é¢è¼‰å…¥æ™‚æª¢æŸ¥ç™»å…¥ç‹€æ…‹
    window.addEventListener('load', async () => {
      log('ğŸ”„ æª¢æŸ¥ç™»å…¥ç‹€æ…‹...', 'info');
      
      const user = await eccalAuth.checkAuth();
      if (user) {
        log(`âœ… åµæ¸¬åˆ°å·²ç™»å…¥ç”¨æˆ¶: ${user.email}`, 'success');
        updateUI(user);
      } else {
        log('â„¹ï¸ ç”¨æˆ¶æœªç™»å…¥', 'info');
        showLoginSection();
      }
    });
    
    // æ•æ‰å…¨åŸŸéŒ¯èª¤
    window.addEventListener('error', (event) => {
      log(`âŒ å…¨åŸŸéŒ¯èª¤: ${event.message}`, 'error');
    });
  </script>
</body>
</html>
