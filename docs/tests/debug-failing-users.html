<!DOCTYPE html>
<html>
<head>
    <title>æŒçºŒå¤±æ•—ç”¨æˆ¶è¨ºæ–·</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .user-card { border: 2px solid #ff5722; background: #ffebee; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .test-btn { background: #d32f2f; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .logs { background: #000; color: #0f0; padding: 15px; font-family: monospace; height: 300px; overflow-y: auto; margin: 10px 0; }
        .error { background: #ffcdd2; color: #d32f2f; padding: 10px; border-radius: 4px; margin: 5px 0; }
        .success { background: #c8e6c9; color: #388e3c; padding: 10px; border-radius: 4px; margin: 5px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš¨ æŒçºŒå¤±æ•—ç”¨æˆ¶è¨ºæ–·å ±å‘Š</h1>
        
        <div class="user-card">
            <h2>å•é¡Œç”¨æˆ¶æ¸…å–®</h2>
            <ul>
                <li>ming2635163@gmail.com</li>
                <li>kaoic08@gmail.com</li> 
                <li>pin10andy@gmail.com</li>
                <li>jamesboyphs@gmail.com</li>
            </ul>
        </div>
        
        <h2>è¨ºæ–·æ¸¬è©¦</h2>
        <button class="test-btn" onclick="testAllUsers()">ğŸ” æ¸¬è©¦æ‰€æœ‰å•é¡Œç”¨æˆ¶</button>
        <button class="test-btn" onclick="checkServerLogs()">ğŸ“‹ æª¢æŸ¥æœå‹™å™¨æ—¥èªŒ</button>
        <button class="test-btn" onclick="testAuthEndpoint()">ğŸ”‘ æ¸¬è©¦èªè­‰ç«¯é»</button>
        <button class="test-btn" onclick="simulateLogin()">ğŸš€ æ¨¡æ“¬ç™»å…¥æµç¨‹</button>
        
        <div id="results"></div>
        <div id="serverLogs" class="logs"></div>
    </div>

    <script>
        const problemUsers = [
            'ming2635163@gmail.com',
            'kaoic08@gmail.com', 
            'pin10andy@gmail.com',
            'jamesboyphs@gmail.com'
        ];
        
        function log(message) {
            const logs = document.getElementById('serverLogs');
            logs.innerHTML += new Date().toISOString() + ' - ' + message + '\n';
            logs.scrollTop = logs.scrollHeight;
        }
        
        async function testAllUsers() {
            document.getElementById('results').innerHTML = '<h3>ğŸ”„ æ¸¬è©¦æ‰€æœ‰å•é¡Œç”¨æˆ¶...</h3>';
            log('é–‹å§‹æ¸¬è©¦æ‰€æœ‰å•é¡Œç”¨æˆ¶');
            
            for (const email of problemUsers) {
                try {
                    log(`æ¸¬è©¦ç”¨æˆ¶: ${email}`);
                    
                    // æ¸¬è©¦ token ç‹€æ…‹
                    const tokenResponse = await fetch('/api/admin/fix-user-token', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email })
                    });
                    
                    const tokenData = await tokenResponse.json();
                    
                    if (tokenResponse.ok) {
                        log(`âœ… ${email} token ç‹€æ…‹æ­£å¸¸: ${tokenData.newExpiry}`);
                    } else {
                        log(`âŒ ${email} token å•é¡Œ: ${tokenData.error}`);
                    }
                    
                    // æ¸¬è©¦ç›´æ¥èªè­‰
                    const authTest = await fetch('/api/user/me', {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer fake-token-for-${email.split('@')[0]}`
                        }
                    });
                    
                    if (authTest.status === 401) {
                        log(`âŒ ${email} èªè­‰å¤±æ•— - é€™æ˜¯é æœŸçš„`);
                    } else {
                        log(`ğŸ¤” ${email} èªè­‰éŸ¿æ‡‰ç•°å¸¸: ${authTest.status}`);
                    }
                    
                } catch (error) {
                    log(`ğŸ’¥ ${email} æ¸¬è©¦éŒ¯èª¤: ${error.message}`);
                }
            }
            
            document.getElementById('results').innerHTML += '<div class="success">æ‰€æœ‰ç”¨æˆ¶æ¸¬è©¦å®Œæˆï¼Œè«‹æŸ¥çœ‹æ—¥èªŒ</div>';
        }
        
        async function checkServerLogs() {
            log('æª¢æŸ¥æœå‹™å™¨éŒ¯èª¤æ—¥èªŒ...');
            
            try {
                const response = await fetch('/api/admin/system-status');
                if (response.ok) {
                    const data = await response.json();
                    log(`æœå‹™å™¨ç‹€æ…‹: ${JSON.stringify(data, null, 2)}`);
                } else {
                    log(`æœå‹™å™¨ç‹€æ…‹æª¢æŸ¥å¤±æ•—: ${response.status}`);
                }
            } catch (error) {
                log(`ç„¡æ³•ç²å–æœå‹™å™¨ç‹€æ…‹: ${error.message}`);
            }
        }
        
        async function testAuthEndpoint() {
            log('æ¸¬è©¦èªè­‰ç«¯é»...');
            
            try {
                const response = await fetch('/api/auth/google', {
                    method: 'GET',
                    redirect: 'manual'
                });
                
                log(`Google OAuth ç«¯é»ç‹€æ…‹: ${response.status}`);
                log(`éŸ¿æ‡‰é¡å‹: ${response.type}`);
                
                if (response.status === 302) {
                    log('âœ… OAuth é‡å®šå‘æ­£å¸¸');
                } else {
                    log('âŒ OAuth ç«¯é»ç•°å¸¸');
                }
            } catch (error) {
                log(`OAuth æ¸¬è©¦éŒ¯èª¤: ${error.message}`);
            }
        }
        
        async function simulateLogin() {
            log('æ¨¡æ“¬ç™»å…¥æµç¨‹æ¸¬è©¦...');
            
            for (const email of problemUsers) {
                log(`æ¨¡æ“¬ ${email} ç™»å…¥...`);
                
                // æ¨¡æ“¬ OAuth å›èª¿
                try {
                    const callbackTest = await fetch(`/api/auth/google/callback?code=fake-code&state=fake-state`, {
                        method: 'GET',
                        redirect: 'manual'
                    });
                    
                    log(`${email} OAuth å›èª¿æ¸¬è©¦: ${callbackTest.status}`);
                } catch (error) {
                    log(`${email} OAuth å›èª¿éŒ¯èª¤: ${error.message}`);
                }
            }
        }
        
        // è‡ªå‹•é–‹å§‹è¨ºæ–·
        window.onload = function() {
            log('è¨ºæ–·å·¥å…·å·²æº–å‚™å°±ç·’');
            log('æº–å‚™æ¸¬è©¦4å€‹æŒçºŒå¤±æ•—çš„ç”¨æˆ¶...');
            setTimeout(testAllUsers, 1000);
        };
    </script>
</body>
</html>